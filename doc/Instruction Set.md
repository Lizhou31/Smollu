# Smollu Instruction Set

| Cat.                                                                                   | Mnemonic (byte value)                | Operands      | Stack effect (T = top) | Purpose / notes                                                          |
| -------------------------------------------------------------------------------------- | ------------------------------------ | ------------- | ---------------------- | ------------------------------------------------------------------------ |
| **00 – 0F   Stack & constants**                                                        |                                      |               |                        |                                                                          |
| 0x00                                                                                   | `NOP`                                | —             | none                   | Do nothing (alignment, breakpoints, patching).                           |
| 0x01                                                                                   | `PUSH_NIL`                           | —             | `… → … nil`            | Push Lua-style *nil*.                                           |
| 0x02                                                                                   | `PUSH_TRUE`                          | —             | `… → … true`           | Boolean constant.                                                        |
| 0x03                                                                                   | `PUSH_FALSE`                         | —             | `… → … false`          |                                                                          |
| 0x04                                                                                   | `PUSH_I8   <i8>`                     | 1 byte        | `… → … int`            | Small int literal (-128…127).                                            |
| 0x05                                                                                   | `PUSH_I32 <i32>`                     | 4 bytes       | `… → … int`            | 32-bit integer literal.                                                  |
| 0x06                                                                                   | `PUSH_F32 <f32>`                     | 4 bytes       | `… → … float`          | 32-bit IEEE float literal.                                               |
| 0x07                                                                                   | `DUP`                                | —             | `… T → … T T`          | Duplicate top.                                                           |
| 0x08                                                                                   | `POP`                                | —             | `… T → …`              | Discard top.                                                             |
| 0x09                                                                                   | `SWAP`                               | —             | `… A B → … B A`        | Swap top two.                                                            |
| **10 – 1F   Local / global vars**                                                      |                                      |               |                        |                                                                          |
| 0x10                                                                                   | `LOAD_LOCAL <u8>`                    | 1 byte        | `… → … val`            | Push local `slot` (0-255).                                               |
| 0x11                                                                                   | `STORE_LOCAL <u8>`                   | 1 byte        | `… val → …`            | Pop → local `slot`.                                                      |
| 0x12                                                                                   | `LOAD_GLOBAL <u8>`                   | 1 byte        | `… → … val`            | Push global `slot` (simple table).                                       |
| 0x13                                                                                   | `STORE_GLOBAL <u8>`                  | 1 byte        | `… val → …`            | Pop → global `slot`.                                                     |
| **20 – 2F   Arithmetic / logic** *(integer and float share opcodes; type tag decides)* |                                      |               |                        |                                                                          |
| 0x20                                                                                   | `ADD`                                | —             | `… b a → … (a+b)`      | +    (int or float)                                                      |
| 0x21                                                                                   | `SUB`                                | —             | `… b a → … (a-b)`      | −                                                                        |
| 0x22                                                                                   | `MUL`                                | —             | `… b a → … (a×b)`      | ×                                                                        |
| 0x23                                                                                   | `DIV`                                | —             | `… b a → … (a÷b)`      | / (int = trunc).                                                         |
| 0x24                                                                                   | `MOD`                                | —             | `… b a → … (a % b)`    | Integer mod.                                                             |
| 0x25                                                                                   | `NEG`                                | —             | `… a → … (-a)`         | Unary minus.                                                             |
| 0x26                                                                                   | `NOT`                                | —             | `… a → … !a`           | Boolean/logical not.                                                     |
| **30 – 3F   Comparison (pushes boolean)**                                              |                                      |               |                        |                                                                          |
| 0x30                                                                                   | `EQ`                                 | —             | `… b a → … (a==b)`     |                                                                          |
| 0x31                                                                                   | `NEQ`                                | —             | `… b a → … (a!=b)`     |                                                                          |
| 0x32                                                                                   | `LT`                                 | —             | `… b a → … (a<b)`      |                                                                          |
| 0x33                                                                                   | `LE`                                 | —             | `… b a → … (a≤b)`      |                                                                          |
| 0x34                                                                                   | `GT`                                 | —             | `… b a → … (a>b)`      |                                                                          |
| 0x35                                                                                   | `GE`                                 | —             | `… b a → … (a≥b)`      |                                                                          |
| **40 – 4F   Control flow** *(relative 16-bit signed offsets)*                          |                                      |               |                        |                                                                          |
| 0x40                                                                                   | `JMP    <i16>`                       | 2 bytes       | none                   | Unconditional PC += offset.                                              |
| 0x41                                                                                   | `JMP_IF_TRUE <i16>`                  | 2             | `… cond → …`           | Jump if cond ≠ 0.                                                        |
| 0x42                                                                                   | `JMP_IF_FALSE <i16>`                 | 2             | `… cond → …`           | Jump if cond == 0.                                                       |
| 0x43                                                                                   | `HALT`                               | —             | —                      | Stop script, return to C.                                                |
| **50 – 5F   Function call frames**                                                     |                                      |               |                        |                                                                          |
| 0x50                                                                                   | `CALL <u8> <u8>`                     | func-ID, argc | `… args → … ret`       | Script fn; pushes ret (or nil). Saves return addr & base-ptr internally. |
| 0x51                                                                                   | `RET <u8>`                           | rv-count      | `… rvs → …`            | Pop rvs, restore frame, push returns.                                    |
| **60 – 6F   Native interface & system**                                                |                                      |               |                        |                                                                          |
| 0x60                                                                                   | `NCALL <u8> <u8>`                    | nat-ID, argc  | `… args → … ret`       | Invoke native C fn (e.g. GPIO, I²C).                                     |
| 0x61                                                                                   | `SLEEP_MS <u16>`                     | 2             | none                   | Yield thread for N ms (`k_msleep`). *(optional helper)*                  |
| **70 – 7F   Table / string (optional extension)**                                      |                                      |               |                        |                                                                          |
| *reserved*                                                                             | (room for arrays, concat, len, etc.) |               |                        |                                                                          |
| **F0–FF   Interpreter meta**                                                           |                                      |               |                        |                                                                          |
| 0xF0                                                                                   | `DBG_TRAP`                           | —             | none                   | Break into debug stub (optional).                                        |
| 0xFF                                                                                   | `ILLEGAL`                            | —             | —                      | Guaranteed fault for bad code; VM should abort.                          |
